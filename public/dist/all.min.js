"use strict";var myApp=angular.module("distralsa",["ngAnimate","ngResource","ngRoute","ngDialog","ngMaterial","ngCookies","ngSanitize","ngCsv","client.services","commande.services","paiement.services","promotion.services"]);myApp.config(["$httpProvider",function($httpProvider){$httpProvider.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",$httpProvider.defaults.headers.common["Content-Type"]="application/json",$httpProvider.defaults.headers.get||($httpProvider.defaults.headers.get={}),$httpProvider.defaults.headers.get["If-Modified-Since"]="0",$httpProvider.defaults.headers.get["Cache-Control"]="no-cache",$httpProvider.defaults.headers.get.Pragma="no-cache"}]),myApp.config(["$mdAriaProvider",function($mdAriaProvider){$mdAriaProvider.disableWarnings()}]),myApp.config(function($mdIconProvider){$mdIconProvider.iconSet("call","icons/sets/communication-icons.svg",24).iconSet("social","icons/sets/social-icons.svg",24)}),myApp.run(function($rootScope,$templateCache,$location,$document,clientService,commandeService){$rootScope.loading=!1,$rootScope.event=!1,$rootScope.next=!1,$rootScope.drapeau="svg/fr.svg",$rootScope.lang="fr",$rootScope.langData=[],$rootScope.current=!1,$rootScope.msie=!1,clientService.loadLang().then(function(data){$rootScope.langData=data.langs,$rootScope.lang=data.client.lang},function(err){console.warn(err),toastr.error(err.statusText)}),$rootScope.$on("$locationChangeStart",function(event,next,current){$rootScope.loading=!0;var hostName=$location.protocol()+"://"+$location.host()+"/";$rootScope.event=event,$rootScope.next=next.replace(hostName,""),$rootScope.current=current.replace(hostName,""),$rootScope.next=""==$rootScope.next?"accueil":$rootScope.next,$rootScope.current=""==$rootScope.current?"accueil":$rootScope.current}),$rootScope.$on("$viewContentLoaded",function(){$templateCache.removeAll(),$rootScope.loading=!1}),$rootScope.go=function(path){$location.path(path)};var originatorEv;$rootScope.openMenu=function($mdMenu,ev){originatorEv=ev,$mdMenu.open(ev)},$rootScope.changeLang=function(ev,lang){$rootScope.lang=lang,clientService.changeLang(lang).then(function(data){$rootScope.langData=data.langs,$rootScope.lang=data.client.lang},function(err){console.warn(err),toastr.error(err.statusText)})};var ua=navigator.userAgent,is_ie=ua.indexOf("MSIE ")>-1||ua.indexOf("Trident/")>-1;is_ie&&($rootScope.msie=!0)}),myApp.config(function($routeProvider,$locationProvider){$routeProvider.when("/accueil",{templateUrl:"/accueil",controller:"accueilCtrl",cache:!0}).when("/commande",{templateUrl:"/commande",controller:"commandeCtrl",cache:!0}).when("/paiement",{templateUrl:"/paiement",controller:"paiementCtrl",cache:!0}).when("/reglement",{templateUrl:"/reglement",controller:"reglementCtrl",cache:!0}).when("/validation",{templateUrl:"/validation",controller:"validationCtrl",cache:!0}).otherwise({redirectTo:"/accueil"}),$routeProvider.when("/admin",{templateUrl:"/admin",controller:"adminCtrl",cache:!0}).when("/admin/index",{templateUrl:"/admin/index",controller:"adminAccueilCtrl",cache:!0}),$locationProvider.html5Mode(!0).hashPrefix("!")}),myApp.controller("adminAccueilCtrl",["$scope","$rootScope","$timeout","clientService","commandeService","promotionService",function($scope,$rootScope,$timeout,$clientService,$commandeService,$promotionService){$scope.promotions=[],$scope.clients=[],$scope.promotion={entreprise:"",reduction:{montant:0,percent:0},valide:!0},$promotionService.getAll().then(function(promotions){$scope.promotions=angular.copy(promotions)},function(err){console.warn(err),toastr.error(err.statusText)}),$clientService.getAll().then(function(clients){$scope.clients=angular.copy(clients)},function(err){console.warn(err),toastr.error(err.statusText)}),$scope.addProm=function(){$promotionService.add($scope.promotion).then(function(prom){$scope.promotions.push(prom),$scope.promotion={entreprise:"",reduction:{montant:0,percent:0},valide:!0}},function(err){console.warn(err),toastr.error(err.statusText)})},$scope.delProm=function(prom){$promotionService["delete"](prom).then(function(data){var idx=$scope.promotions.indexOf(prom);-1!==idx&&$scope.promotions.splice(idx,1)},function(err){console.warn(err),toastr.error(err.statusText)})},$scope.modifProm=function(prom){$scope.promotion.entreprise=prom.entreprise,$scope.promotion.reduction=prom.reduction,$promotionService.modif($scope.promotion).then(function(newProm){var idx=$scope.promotions.indexOf(prom);-1!==idx&&($scope.promotions[idx]=angular.copy(newProm)),$scope.promotion={entreprise:"",reduction:{montant:0,percent:0},valide:!0}},function(err){console.warn(err),toastr.error(err.statusText)})}}]),myApp.controller("accueilCtrl",["$scope","$rootScope","$timeout","clientService","commandeService",function($scope,$rootScope,$timeout,$clientService,$commandeService){$scope.zones=new Array,$scope.regions=new Array,$scope.sumNet=0,$scope.sumBrut=0,$scope.total=0,$scope.commande={},$clientService.getMe().then(function(rep){$timeout(function(){$scope.client=rep.client,$scope.commande=rep.commande,$scope.zones=rep.commande.zones.map(function(zone){var villeName=zone.Ville.replace("_"," ");return{Ville:zone.Ville,name:villeName[0].toUpperCase()+villeName.substr(1),region:zone.region,brut:zone.brut,net:zone.net}});var format=$scope.commande.format;"A4"!=format&&"A5"!=format&&"A6"!=format&&($scope.formatAutre=format),$scope.calcSum(),runDatepicker(),$scope.$apply()},150)},function(err){console.warn(err),toastr.error(err.statusText)}),$scope.calcTotal=function(){$commandeService.modif($scope.commande._id,$scope.commande).then(function(cmd){$scope.commande.total=cmd.total,$scope.commande.totalHT=cmd.totalHT},function(err){console.warn(err),toastr.error(err.statusText)})},$scope.saveCommande=function(path){$commandeService.modif($scope.commande._id,$scope.commande).then(function(cmd){angular.copy(cmd,$scope.commande),$rootScope.go(path)},function(err){console.warn(err),toastr.error(err.statusText)})},$scope.ajout=function(data){var villeName=data.Ville.replace("_"," ");data.name=villeName[0].toUpperCase()+villeName.substr(1),$scope.zones.push(data),$scope.commande.zones=angular.copy($scope.zones),$scope.calcSum(),$scope.$apply()},$scope.ajoutMulti=function(data,apply){void 0==apply&&(apply=!1),data.forEach(function(d){var villeName=d.Ville.replace("_"," ");d.name=villeName[0].toUpperCase()+villeName.substr(1);var idx=$scope.zones.map(function(zon){return zon.Ville}).indexOf(d.Ville);-1===idx&&$scope.zones.push(d)}),$scope.commande.zones=angular.copy($scope.zones),$scope.calcSum()},$scope.remove=function(data,apply){void 0==apply&&(apply=!1);var idx=$scope.zones.map(function(zon){return zon.Ville}).indexOf(data.Ville);-1!==idx&&$scope.zones.splice(idx,1),$scope.commande.zones=angular.copy($scope.zones),$scope.calcSum(),apply&&$scope.$apply()},$scope.removeMulti=function(data,apply){void 0==apply&&(apply=!1),data.forEach(function(d){var idx=$scope.zones.map(function(zon){return zon.Ville}).indexOf(d.Ville);-1!==idx&&$scope.zones.splice(idx,1)}),$scope.commande.zones=angular.copy($scope.zones),$scope.calcSum(),apply&&$scope.$apply()},$scope.calcSum=function(){return 0==$scope.zones.length?($scope.sumBrut=0,$scope.sumNet=0,void $scope.calcTotal()):($scope.sumBrut=$scope.zones.map(function(c){return parseFloat(c.brut)}).reduce(function(a,b){return a+b}),$scope.sumNet=$scope.zones.map(function(c){return parseFloat(c.net)}).reduce(function(a,b){return a+b}),$timeout(function(){$("#listVille").scrollTop($("#listVille > table").height())},10),$scope.calcTotal(),void $scope.changeMap())},$scope.changeMap=function(e){$scope.regions=new Array,$scope.national?($scope.nord=!0,$scope.est=!0,$scope.sud=!0,$scope.centre=!0):e&&"national"==e.target.id&&($scope.nord=!1,$scope.est=!1,$scope.sud=!1,$scope.centre=!1),$scope.nord&&$scope.regions.push("Nord / norden"),$scope.est&&$scope.regions.push("Est / osten"),$scope.sud&&$scope.regions.push("Sud / suden"),$scope.centre&&$scope.regions.push("Centre / zentrum")},$scope.addRegion=function(name,apply){void 0==apply&&(apply=!1),"Nord / norden"==name&&($scope.nord=!0),"Est / osten"==name&&($scope.est=!0),"Sud / suden"==name&&($scope.sud=!0),"Centre / zentrum"==name&&($scope.centre=!0),$scope.nord&&$scope.est&&$scope.centre&&$scope.sud?$scope.national=!0:$scope.national=!1,$scope.changeMap(!1),apply&&$scope.$apply()}}]),myApp.controller("commandeCtrl",["$scope","$rootScope","clientService","commandeService",function($scope,$rootScope,$clientService,$commandeService){$scope.client={},$scope.commande={},$scope.zones=[],$scope.path="",$clientService.getMe().then(function(rep){$scope.client=rep.client,$scope.commande=rep.commande,$scope.zones=angular.copy(rep.commande.zones)},function(err){console.warn(err)}),$scope.saveClient=function(path){path&&void 0!==path||(path=$scope.path),$clientService.modif($scope.client._id,$scope.client).then(function(client){angular.copy(client,$scope.client),$rootScope.go(path)})}}]),myApp.controller("paiementCtrl",["$scope","$location","$rootScope","clientService","commandeService","paiementService",function($scope,$location,$rootScope,$clientService,$commandeService,$paiementService){$scope.client={entreprise:"",adresse:"",ville:"",pays:"","activit√©":"",telephone:"",tva:""},$scope.commande={intitule:"",poid:"",format:"",contenu:"",semaine:"",total:0};var hostName=$location.protocol()+"://"+$location.host()+":"+$location.port()+"/";$scope.paiement={montant:0,percent:$scope.frais,cardRegistration:{AccessKey:"",CardRegistrationURL:hostName,CardType:"",PreregistrationData:"",returnURL:hostName+"reglement"},crypto:"",date:{mois:1,year:2018}},$scope.enCours=!1,$clientService.getMe().then(function(rep){$scope.client=rep.client,$scope.commande=rep.commande,angular.copy(rep.commande.zones,$scope.zones),angular.copy(rep.commande.total,$scope.paiement.montant)},function(err){console.warn(err)}),$scope.saveCard=function(card){return $paiementService.saveCard(card).then(function(rep){return!0},function(err){return console.warn(err),toastr.error(err.statusText),!1})},$scope.mois=_.range(1,13).map(function(n){var d=new Date;return d.setMonth(n),12==n?"12":10>n?"0"+d.getMonth():d.getMonth()}),$scope.years=_.range(15).map(function(n){var d=new Date;return d.setYear(d.getFullYear()+n),d.getFullYear()}),$scope.typeCard=function(e){var val=$scope.paiement.carte,newval="";val=val.replace(/\s/g,"");for(var i=0;i<val.length;i++)i%4==0&&i>0&&(newval=newval.concat(" ")),newval=newval.concat(val[i]);$scope.paiement.carte=newval}}]),myApp.controller("validationCtrl",["$scope","$rootScope","$timeout","commandeService",function($scope,$rootScope,$timeout,$commandeService){var next=function(){$commandeService.clear(),$timeout(function(){$rootScope.go("/")},2500)};$commandeService.email().then(function(rep){next()},function(err){console.warn(err),toastr.error(err.statusText),next()})}]),myApp.controller("reglementCtrl",["$scope","$location","$timeout","commandeService",function($scope,$location,$timeout,$commandeService){var next=function(){$commandeService.clear(),$timeout(function(){$rootScope.go("/")},2500)};$commandeService.email().then(function(rep){next()},function(err){console.warn(err),toastr.error(err.statusText),next()})}]),myApp.directive("d3Map",["$timeout","$window",function($timeout,$window){return{restrict:"A",scope:{map:"@",cities:"@",regions:"=",zonesData:"=",width:"@",height:"@",ctrlAjout:"=",ctrlRemove:"=",ctrlAjoutMulti:"=",ctrlRemoveMulti:"=",ctrlRegionActif:"="},link:function(scope,ele,attrs){var margin={top:0,right:0,bottom:0,left:0},width=d3.select(ele[0]).node().offsetWidth,width=void 0===scope.width?width:scope.width,width=width-margin.left-margin.right,height=void 0===scope.height?2e3:scope.height,height=height-margin.top-margin.bottom;void 0===scope.map?"Luxembourg.svg":scope.map,void 0===scope.cities?"Commune.tsv":scope.cities,void 0===scope.regions?new Array:scope.regions;scope.data=null,scope.zonesData=new Array,scope.paths=new Array;var colorCentre="#5d2491",colorSud="#c01a2c",colorEst="#3871c2",colorNord="#fbbd13";width=d3.select(ele[0]).node().offsetWidth;var svg=d3.select(ele[0]).append("svg").attr("width",width).attr("height",height);d3.format(".1f");window.addEventListener("resize",function(){width=d3.select(ele[0]).node().offsetWidth,svg.attr("width",width),d3.select("g").remove(),scope.render(scope.map)}),scope.$watch("map",function(newData,oldValue){scope.render(newData)},!0),scope.$watch("cities",function(newData,oldValue){scope.loadFile(newData)},!0),scope.$watch("regions",function(newData,oldValue){var zoneRemoves=new Array,zoneAjouts=new Array;scope.regions=angular.copy(newData);var zonesDeja=angular.copy(scope.zonesData);void 0===oldValue&&(oldValue=new Array),scope.paths.forEach(function(path){var id=path.attr("id"),data=scope.data[id],idxZone=zonesDeja.map(function(z){return z.Ville}).indexOf(data.Ville);-1!==scope.regions.indexOf("national")&&-1===idxZone?(zonesDeja.push(data),zoneAjouts.push(data)):-1!==scope.regions.indexOf(data.region)&&-1===idxZone?(zonesDeja.push(data),zoneAjouts.push(data)):-1!==oldValue.indexOf(data.region)&&-1===scope.regions.indexOf(data.region)&&-1!==idxZone&&(zonesDeja.splice(idxZone,1),zoneRemoves.push(data))}),scope.paths.forEach(function(p){var id=p.attr("id"),data=scope.data[id];zonesDeja.length>0&&(-1!==zonesDeja.map(function(z){return z.Ville}).indexOf(data.Ville)?(p.attr("class","pathActive"),"Centre / zentrum"==data.region?p.attr("fill",colorCentre):"Est / osten"==data.region?p.attr("fill",colorEst):"Sud / suden"==data.region?p.attr("fill",colorSud):"Nord / norden"==data.region&&p.attr("fill",colorNord)):p.attr("fill","white").attr("class","pathRegion"))}),zoneAjouts.length>0&&scope.ctrlAjoutMulti(zoneAjouts),zoneRemoves.length>0&&scope.ctrlRemoveMulti(zoneRemoves)},!0),scope.$watch("zonesData",function(newData,oldValue){$timeout(function(){var zonesDeja=angular.copy(newData);scope.paths.forEach(function(p){var id=p.attr("id"),data=scope.data[id];zonesDeja.length>0&&-1!==zonesDeja.map(function(z){return z.Ville}).indexOf(data.Ville)?(p.attr("class","pathActive"),"Centre / zentrum"==data.region?p.attr("fill",colorCentre):"Est / osten"==data.region?p.attr("fill",colorEst):"Sud / suden"==data.region?p.attr("fill",colorSud):"Nord / norden"==data.region&&p.attr("fill",colorNord)):p.attr("fill","white").attr("class","pathRegion")});var regions=new Array("Centre / zentrum","Est / osten","Sud / suden","Nord / norden");regions.forEach(function(reg){var nb=scope.paths.filter(function(path){var id=path.attr("id"),data=scope.data[id];return data.region==reg}).length,nbActif=zonesDeja.filter(function(zone){return zone.region==reg}).length;nb==nbActif&&nb>0&&nbActif>0&&scope.ctrlRegionActif(reg)}),scope.zonesData=angular.copy(zonesDeja)},200)},!0),scope.render=function(map){if(void 0!==map){var g=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").attr("class","map");$timeout(function(){d3.xml(map).mimeType("image/svg+xml").get(function(error,doc){error&&console.warn(error);var elts=Array.from(doc.getElementsByTagName("path"));elts=elts.filter(function(p){return"path"!=p.getAttribute("id").substr(0,4)});for(var pathCoords=new Array,i=0;i<elts.length;i++){var d=elts[i].getAttribute("d"),id=elts[i].getAttribute("id"),path=g.append("path").attr("d",d).attr("fill","white").classed("top",!1).attr("stroke-width",2).attr("stroke","black").attr("id",id).attr("class","pathRegion"),region=scope.data[id];scope.paths.push(path),scope.regions.length>0&&void 0!==region&&scope.paths.forEach(function(path){var id=path.attr("id"),data=scope.data[id];-1!==scope.regions.indexOf("national")&&-1===scope.zonesData.indexOf(data)?scope.zonesData.push(data):-1!==scope.regions.indexOf(data.region)&&-1===scope.zonesData.indexOf(data)&&scope.zonesData.push(data)});var box=path.node().getBBox();pathCoords.push(box);var center={x:box.x+box.width/2,y:box.y+box.height/2};path.append("circle").attr("cx",center.x).attr("cy",center.y).attr("r","4px").attr("fill","black").classed("top",!0)}var regions=new Array("Centre / zentrum","Est / osten","Sud / suden","Nord / norden");regions.forEach(function(reg){var nb=scope.paths.filter(function(path){var id=path.attr("id"),data=scope.data[id];return data.region==reg}).length,nbActif=scope.zonesData.filter(function(zone){return zone.region==reg});nb==nbActif&&scope.ctrlRegionActif(reg)});var minY=d3.min(pathCoords.map(function(p){return p.y})),minX=d3.min(pathCoords.map(function(p){return p.x}));g.attr("transform","translate("+1.1*minX+",-"+.1*minY+") scale(0.95,1)");var maxY=d3.max(pathCoords.map(function(p){return p.y+p.height})),maxX=d3.max(pathCoords.map(function(p){return p.x+p.width})),rect=g.append("rect").attr("x",.8*maxX).attr("y",maxY/5).attr("width",.4*maxX).attr("height",.2*maxY).attr("stroke","grey").attr("fill","none").attr("rx","8").attr("ry","8").attr("stroke-width",3),line=g.append("line").attr("x1",center.x).attr("y1",center.y).attr("x2",rect.attr("x")).attr("y2",parseInt(rect.attr("y"))+parseInt(rect.attr("height")/2)).attr("stroke-width",3).attr("stroke","grey"),data=angular.copy(region),x=parseInt(rect.attr("x")),y=parseInt(rect.attr("y")),ville=(parseInt(rect.attr("width")),parseInt(rect.attr("height")),g.append("text").attr("x",x+15).attr("y",y+35).attr("font-size","30px").text(data.Ville).attr("fill","black")),region=g.append("text").attr("x",x+15).attr("y",y+65).attr("font-size","20px").text(data.region).attr("fill","black"),brut=g.append("text").attr("x",x+15).attr("y",y+105).attr("font-size","30px").text(data.brut).attr("fill","black"),net=g.append("text").attr("x",x+15).attr("y",y+135).attr("font-size","30px").text(data.net).attr("fill","black");"Centre / zentrum"==data.region?region.attr("fill",colorCentre):"Est / osten"==data.region?region.attr("fill",colorEst):"Sud / suden"==data.region?region.attr("fill",colorSud):"Nord / norden"==data.region&&region.attr("fill",colorNord),g.selectAll("path").on("mouseover",function(d,i){d3.select(this).attr("fill","orange");var circle=d3.select(this).select("circle");line.attr("x1",circle.attr("cx")).attr("y1",circle.attr("cy"));var id=d3.select(this).attr("id");if(-1!==Object.keys(scope.data).indexOf(id)){var d=scope.data[id],villeName=d.Ville.replace("_"," ");villeName=villeName[0].toUpperCase()+villeName.substr(1),ville.text(villeName),region.text(d.region),brut.text("Brut : "+d.brut),net.text("Net : "+d.net),"Centre / zentrum"==d.region?d3.select(this).attr("fill",colorCentre):"Est / osten"==d.region?d3.select(this).attr("fill",colorEst):"Sud / suden"==d.region?d3.select(this).attr("fill",colorSud):"Nord / norden"==d.region&&d3.select(this).attr("fill",colorNord),"Centre / zentrum"==d.region?region.attr("fill",colorCentre):"Est / osten"==d.region?region.attr("fill",colorEst):"Sud / suden"==d.region?region.attr("fill",colorSud):"Nord / norden"==d.region&&region.attr("fill",colorNord)}else ville.text(id),region.text(""),brut.text(""),net.text("")}).on("mouseout",function(d,i){"pathActive"!=d3.select(this).attr("class")&&d3.select(this).attr("fill","white")}).on("click",function(d,i){var id=d3.select(this).attr("id"),data=scope.data[id];"pathActive"==d3.select(this).attr("class")?(scope.ctrlRemove(data,!0),d3.select(this).attr("class","pathRegion").attr("fill","white")):(scope.ctrlAjout(data),d3.select(this).attr("class","pathActive"),"Centre / zentrum"==data.region?d3.select(this).attr("fill",colorCentre):"Est / osten"==data.region?d3.select(this).attr("fill",colorEst):"Sud / suden"==data.region?d3.select(this).attr("fill",colorSud):"Nord / norden"==data.region&&d3.select(this).attr("fill",colorNord))})})},0)}},scope.loadFile=function(file){d3.csv(file,function(data){scope.data={},data.forEach(function(d){scope.data[d.Ville]=d})})}}}}]),angular.module("client.services",[]).service("clientService",["$q","$http",function($q,$http){return{get:function(id){return $http.post("/api/client/get",{id:id}).then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},getAll:function(){return $http.post("/api/client/getAll").then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},getMe:function(){return $http.get("/api/client/getMe").then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},add:function(coordonnee){return $http.put("/api/client/",{coordonnee:coordonnee}).then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},modif:function(clientId,coordonnee){return $http.patch("/api/client/",{clientId:clientId,coordonnee:coordonnee}).then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},changeLang:function(lang){return $http.patch("/api/client/lang",{lang:lang}).then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},loadLang:function(){return $http.get("/api/client/lang").then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})}}}]),angular.module("commande.services",[]).service("commandeService",["$q","$http",function($q,$http){return{get:function(id){return $http.post("/api/commande/get",{id:id}).then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},getMe:function(){return $http.get("/api/commande/getMe").then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},modif:function(commandeId,commande){return $http.patch("/api/commande/",{commandeId:commandeId,commande:commande}).then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},clear:function(){return $http.get("/api/commande/clear").then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},email:function(){return $http.get("/api/commande/email").then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})}}}]),angular.module("paiement.services",[]).service("paiementService",["$q","$http",function($q,$http){return{get:function(id){return $http.post("/api/paiement",{id:id}).then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},add:function(paiement){return $http.put("/api/paiement",{paiement:paiement}).then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},modif:function(paiement){return $http.patch("/api/paiement",{paiement:paiement}).then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},saveCard:function(card){return $http.put("/api/paiement/card",{card:card}).then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},getCard:function(){return $http.post("/api/paiement/card").then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})}}}]),angular.module("promotion.services",[]).service("promotionService",["$q","$http",function($q,$http){return{get:function(id){return $http.post("/api/promotion/get",{id:id}).then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},getAll:function(){return $http.post("/api/promotion/getAll").then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},add:function(promotion){return $http.put("/api/promotion/",{promotion:promotion}).then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},modif:function(promotion){return $http.patch("/api/promotion/",{promotion:promotion}).then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})},"delete":function(promotion){return $http["delete"]("/api/promotion/?promId="+promotion._id).then(function(response){return $q.when(response.data)},function(err){return 404==err.status?$q.reject("non trouv√©"):$q.reject(err)})}}}]);